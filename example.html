<!DOCTYPE html>
<html>
	<head>
		<title>Resource Request Allocation</title>
		<script src="munkres.js" type="text/javascript"></script>
		<script type="text/javascript">/*<![CDATA[*/
			const resources = ['Alice', 'Bob', 'Charlie', 'Danielle', 'Eric', 'Francis'],
				rrs = ['rr1', 'rr2', 'rr3', 'rr4', 'rr5', 'rr6'];

			document.addEventListener('DOMContentLoaded', function() {
				// set up table
				/*
				const table = document.getElementById('example-table'),
					N = resources.length;

				for (var i = 0; i < N; ++i) {
					var tr = document.createElement('tr');

					for (var j = 0; j < N; ++j) {
						var td = document.createElement('td');
						td.setAttribute('id', 'tab-' + i + '-' + j);
						var input = document.createElement('input');
						input.setAttribute('type', 'text');
						input.addEventListener('change', update);
						td.appendChild(input);
						tr.appendChild(td);
					}

					table.appendChild(tr);
				}
				*/

				const table = document.getElementById('resource-table');

				resources.forEach((resource, idx) => {
					const tr = document.createElement('tr'),
						td = document.createElement('td');

					td.innerText = resource;
					tr.appendChild(td);

					rrs.forEach((rr, rrIdx) => {
						const td = document.createElement('td');
						const input = document.createElement('input');

						td.setAttribute('id', 'tab-' + rrIdx + '-' + idx);
						input.setAttribute('type', 'text');
						input.addEventListener('change', update);
						td.appendChild(input);
						tr.appendChild(td);
					});

					table.appendChild(tr);
				});

				update();
			});

			function getMatrix() {
				var matrix = [], N = resources.length;

				for (var i = 0; i < N; ++i) {
					matrix[i] = [];
					for (var j = 0; j < N; ++j)
						matrix[i][j] = parseInt(document.getElementById('tab-' + i + '-' + j).children[0].value) || 0;
				}

				return matrix;
			}

			function update() {
				const matrix = getMatrix();

				highlightSolution(matrix, solve(matrix));
			}



			function highlightSolution(matrix, indices) {
				let totalCost = 0;

				removeClass();
				for (var k = 0; k < indices.length; ++k) {
					var i = indices[k][0], j = indices[k][1];
					totalCost += matrix[i][j];
					document.getElementById('tab-' + i + '-' + j).className = 'active';
				}

				document.getElementById('total-cost').value = totalCost;
				document.getElementById('indices').value = formatIndicesAsString(indices);
			}

			function removeClass() {
				const N = resources.length;

				for (var i = 0; i < N; ++i) {
					for (var j = 0; j < N; ++j) {
						document.getElementById('tab-' + i + '-' + j).className = '';
					}
				}
			}

			function solve(matrix) {
				return new Munkres().compute(matrix);
			}

			function formatIndicesAsString(indices) {
				return indices.map(ind => {
					return [ '[', ind.join(','), ']' ].join('');
				}).join(', ');
			}

		/*]]>*/</script>

		<style>/*<![CDATA[*/
		.active {
			background-color: #e77;
		}
		#indices {
			min-width:15em;
		}
		/*]]>*/</style>
	</head>
	<body>
		<h1>Resource Allocation Using Hungarian Method</h1>
		<table id="example-table">
		</table>
		<p>
			Total Cost: <input disabled id="total-cost" />
		</p>
		<p>
			Indices: <input disabled id="indices" />
		</p>
		<table id="resource-table"></table>
	</body>
</html>
